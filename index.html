<html>
<head>
<title>jessicas' Forms Form</title>
<script src="d3.v3.min.js" charset="utf-8"></script>
<script src="jquery.min.js"></script>

<script>


function applyRuleToExample(rule, example) {
    var result, final_result;

    result = rule.replace("[term]", example)

    var match = /\((.+?)->(.+?)\)/g.exec(result);

    if (match) {
        result = result.replace(/\(.+?->.+?\)/, "")

        // get the string right before it
        replace_this_string_len = match[1].length;

        could_be_a_match = result.substr(match.index - replace_this_string_len, replace_this_string_len);

        if (could_be_a_match == match[1]) {
            result = result.substr(0, match.index - replace_this_string_len)
                + match[2]
                + result.substr(match.index, result.length - 1);
        }
    }

    return result;
}


function pairOffData(x, y) {
    result = [];
    for (var height=0; height < y.length; height++) {
        var newList = [];
        for (var width=0; width < x.length; width++) {
            newList.push(applyRuleToExample(x[width], y[height]));
        }
        result.push(newList);
    }

    return result;
}


function updateGrid() {

    var matrix = pairOffData(
        d3.selectAll(".rule")[0].map(function(d) {return $(d).val()}),
        d3.selectAll(".example")[0].map(function(d) {return $(d).val()})
    );

    var tr = d3.select("#grid table tbody").selectAll("tr")
        .data(matrix);

    tr.enter().append('tr');

    var td = tr.selectAll("td")
        .data(function (d) {return d;});

    td.enter().append('td');

    // update old values
    td.text(function (d) {return d;});

}


function main() {
    var current_width_of_grid = 5;
    var current_height_of_grid = 10;

    d3.select("#rule").selectAll("input")
        .data(d3.range(current_width_of_grid))
        .enter()
        .append("input")
        .attr("class", "rule")
        .on("keyup", updateGrid);


    d3.select("#examples").selectAll("input")
        .data(d3.range(current_height_of_grid))
        .enter()
        .append("div")
        .append("input")
        .attr("class", "example")
        .on("keyup", updateGrid);

    updateGrid();

}


$(document).ready(function () {
    main();
})



</script>

</head>
<body>
<h1>Welcome to the form forms of formulation!</h1>
<p>Oh dear, that name has got to go</p>

<h2>Step 1: Give me some info</h2>
<p>Enter some words</p>

<h3>The Grid</h3>
<div id="grid">
<table>
<thead></thead>
<tbody></tbody>
</table>
</div>

<h3>Rule</h3>
<div id="rule">
</div>


<h3>Examples</h3>
<div id="examples">
</div>





</body>
</html>